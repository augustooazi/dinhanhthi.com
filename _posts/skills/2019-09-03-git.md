---
layout: post
title: "Git / Github / Gitlab"
categories: [skills]
keywords: "github git gitlab branches merge remove clone github desktop gitkraken push pull commit discard changes repository staged alias git gui gitk reset checkout ssh clone to local key rename branch local remote restore commit stash pull push -m -d -b master remote checkout -- . : -s ours FETCH HEAD comparelog -1 --prep status checkout gui graphic repository repo config credential.helper store --global git cheatsheet quit vim exit vim editor upstream corresponding local remote branches repo template notetheme notetheme2 fatal: Authentication failed for two factor authentication"
---

{% assign img-url = '/img/post/others' %}

{% include toc.html %}

Quick references for basic tasks with git.

## Installation & Tools

- Download and install (to use command lines): [git's homepage](https://git-scm.com/downloads).
- Git client tools: [Github Desktop](https://desktop.github.com/) (Windows and MacOS), [GitKraken](https://www.gitkraken.com/download) (Windows, Linux, MacOS).
- Read `html` files in repository on Github: use [this tool](/github-html).

## Rules to be more effective

- Do commit early and often.<sup>[[ref]](https://sethrobertson.github.io/GitBestPractices/)</sup>
- Do make useful commit messages.
- Create a new branch for every new feature.
- Use `pull` requests to merge code to `master`.<sup>[[ref]](https://www.freecodecamp.org/news/follow-these-simple-rules-and-youll-become-a-git-and-github-master-e1045057468f/)</sup>
- For temporary branches, name them starting with `_`.

## Check the status

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# CHECK STATUS
git status
git status -s # modified files
~~~

~~~ bash
# Get remote list
git remote -v
~~~
</div>

~~~ bash
# WITH COLORS
git log --oneline --graph --color --all --decorate
# --graph: draw text-based branches
# --decorate: display names and tags
~~~

Check some commit:

~~~ bash
git log -- <file> # check commits containing <file>
git log --prep='abc' # look for commits containing "abc" in their name
git log <from>..<to> # display commints from <from> to <to> (commit's id, branch's name,...) 
~~~

Check current `HEAD`

~~~   bash
git log -1
# something likes HEAD -> <branch-name>
~~~

Check the change of some file,

~~~ bash
git diff file_name.abc 
~~~

## Settings on local machine

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# SET GLOBAL INFO
git config --global user.name "Anh-Thi DINH"
git config --global user.email "dinhanhthi@gmail.com"
~~~

~~~ bash
# IF: `Could not resolve host: github.com`
git config --global --unset http.proxy 
git config --global --unset https.proxy
~~~
</div>

~~~ bash
# SAVE GITHUB AS DEFAULT
# (don't need to log in again every time we use)
git config credential.helper store
git pull
~~~

~~~ bash
# FORMATTING DISPLAY
git config color.ui true # add colors to the results
git config format.pretty oneline # disply only one line of each commit
~~~

## Repositories

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# CREATE REPO
git init <repo-name>
~~~

~~~ bash
# CLONE REPO (using https or ssh)
git clone <repo-link>
~~~
</div>

## Git GUI

~~~ bash
git gui
gitk
~~~

## Staged & Commits & Push & Pull

### Staged

~~~ bash
# ADD MODIFICATION (1 FILE)
git add * # add all the changes
git add <file-name> # only add the <file-name> to the staged
~~~

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# UNSTAGE A FILE
git reset HEAD <file>
~~~

~~~ bash
# UNSTAGED EVERYTHING
git reset
~~~
</div>

### Commit & Push

~~~ bash
# MAKE COMMIT (FROM STAGED)
git commit -m '<comment-for-this-commit>'
git commit -a # commit any files
~~~

~~~ bash
# PUSH TO REMOTE
git push origin <branch-name> # push only <branch-name>
git push --all origin # push all branches
~~~

~~~ bash
# CHECK & TEST A COMMIT
git checkout <commit-id>
# after testing
git checkout <current-branch>
~~~

### Pull

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# LIST ALL REMOTE REPOS
git remote -v
~~~

~~~ bash
# UPDATE REMOTE -> LOCAL
git pull origin <branch-on-remote>
~~~
</div>

~~~ bash
# COPY A COPY FROM REMOTE
git fetch origin <branch-on-remote>
# compare current branch to this copy
git diff --stat FETCH_HEAD
~~~

## Branches

### Create

~~~ bash
# CREATE A BRANCH
git branch <branch-name>
~~~

~~~ bash
# CREATE AND MOVE TO NEW BRANCH
# This one is based on the current `HEAD` (git log -1).
git checkout -b <new-branch>
# new branch based on another one
git checkout -b <new-branch> <existing-branch>
~~~

### Two branches

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# CHANGE TO ANOTHER BRANCH
git checkout <branch-name>
~~~

~~~ bash
# LIST ALL LOCAL BRANCHES
git branch
~~~

~~~ bash
# LIST ALL LOCAL + REMOTE
git branch -a
~~~

~~~ bash
# UPDATE ALL REMOTE BRANCHES TO LOCAL
# (there may be deleted branches on remote)
git remote update origin --prune
~~~

~~~ bash
# COMPARE 2 BRANCHES
git diff <source-branch> <compared-branch>
~~~

~~~ bash
# LOCAL <-> REMOTE BRANCHES
git branch -vv
~~~
</div>

~~~ bash
# CORRESPONDING LOCAL BRANCH <-> REMOTE
git branch --set-upstream-to=origin/<remote_branch> <local_branch>
~~~

### Delete

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# DEL A LOCAL BRANCH
git branch -d <branch-name>
~~~

~~~ bash
# DEL A REMOTE BRANCH
git push origin :<branch-name>
~~~
</div>

### Merge

~~~ bash
# MERGE <branch> TO CURRENT
git merge <branch>
~~~

~~~ bash
# MERGE <sub-branch> TO master + REPLACE master
git checkout <sub-branch>
git merge -s ours master
git checkout master
git merge <sub-branch>
~~~~

~~~ bash
# MERGE `/link/to/abc.xyz` FROM `<branch-1>` TO `<branch-2>` (can be `master`)
git checkout branch-2
git checkout branch-1 /link/to/abc.xyz
~~~

~~~ bash
# MERGE ONLY SOME FOLDER
git checkout template
git checkout master folder1\ folder2\
~~~

~~~ bash
# MERGE commit from ONE BRANCH to CURRENT
git cherry-pick <commit hash>
~~~

~~~ bash
# KEEP FILES/FOLDERS FROM MERGE
# add line to .gitattributes
echo 'file_name.txt merge=ours' >> .gitattributes 
~~~

### Conflict

If there are changes from both local and remote, there will be conflicts! Something likes that,

~~~ bash
<<<<<< HEAD
changes on local
======
changes from remote
>>>>>> template/notetheme2
~~~

If you use [Visual Studio Code](/visual-studio-code), there is a small toolbar above each conflict and you can choose which one you prefer to keep!

Prefer one of them?

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
# keep remote changes
git pull -X theirs <remote-repo>
~~~

~~~ bash
# keep local changes
git pull -X ours <remote-repo>
~~~
</div>

Keep both? Using Visual Studio Code or,

~~~ bash
# add below line to .gitattributes
echo "*.whatever merge=union" .gitattributes
~~~

Already in conflicted state?

<div class="flex-auto-equal-2" markdown="1">
~~~ bash
git checkout --theirs path/to/file # remote
git checkout --ours path/to/file # local
~~~

~~~ bash
# Abort the conflicts
git merge --abort
~~~
</div>


### Rename

~~~ bash
# CURRENT BRANCH
git branch -m <newname>
git branch -M <newname> # if there are only capitalization changes 
~~~

~~~ bash
# CURRENT IS ANOTHER BRANCH
git branch -m <oldname> <newname>
~~~

~~~ bash
# RENAME REMOTE BRANCH (delete old + push new)
# (rename local branch first)
git push origin :<oldname> <newname>
# reset the upstream branch for the new-name local branch
git checkout <newname>
git push origin -u <newname>
~~~

### Others

Add a description (using [Vim](https://www.vim.org/) editor):

~~~ bash
git branch --edit-description
~~~

In the case you wanna exit Vim, press <kbd>ESC</kbd> then type `:q` to quit or `:wq` to write and quit.

## Discard the changes

~~~ bash
# DISCARD CHANGES ON CURRENT DIR
git checkout -- . # for all changes
git checkout -- <file-name> # for a specific file (go back the last commit of this file)
~~~

~~~ bash
# DISCARD ALL LOCAL CHANGES
git reset --hard
~~~

In the case you want to discard the changes but **want to make a save** before moving to another branch to test. You can use below line. 

~~~ bash
git stash
~~~

If you wanna get back to the place you saved (and remove it from the stashed list), just go back to the branch you make the save and use

~~~ bash
git stash pop
~~~

## Restore

~~~ bash
# RESTORE FROM LAST COMMIT
git checkout -- <file>
~~~

~~~ bash
# DISCARD ALL CHANGES ON LOCAL + GET FROM REMOTE
git fetch origin
git reset --hard origin/master
~~~

~~~ bash
# EREASE ALL COMMITS + BACK TO <commit-id>
git reset --hard <commit-id>
~~~

## Alias

Normally, we use `git branch`. If we wanna use `git br` instead, we use an alias:

~~~ bash
git config alias.br branch
~~~

## Gitlab: Clone a private repo to local

1. Open and copy key in `C:\Users\dinha\.ssh\id_rsa.pub`
2. Go to **Gitlab** > **Settings** > **SSH Keys** > paste a copied key and name it.
3. Clone again the repo and it shoule be working!

## Github

### Info

- Commits to a **fork** don't appear in your contributions graph.
- Commits to a generated from **template** can appear in your contributions graph.

### Repo template

I wanna make a theme [`notetheme2`](https://github.com/dinhanhthi/notetheme2) based on [dinhanhthi.com](https://github.com/dinhanhthi/dinhanhthi.com). 

1. Make `dinhanhthi.com` be a template (Go to _Settings_)
2. Create a new repo based on this template.
3. Create a new branch `notetheme2` on `dinhanhthi.com`. Make changes on this branch.
4. Everything we have a "theme change" on `dinhanhthi.com/master`, merge it to branch `dinhanhthi.com/notetheme2`.
5. If there are files/folders in `dinhanhthi.com/notetheme2` you wanna keep, add below line to `.gitattributes` (under branch `dinhanhthi.com/notetheme2`) before performing the merge,
    ~~~ bash
# add line to .gitattributes
echo 'file_name.txt merge=ours' >> .gitattributes 
    ~~~
6. Update changes from `dinhanhthi.com/notetheme2` to repo `notetheme2`{% ref https://stackoverflow.com/questions/56577184/github-pull-changes-from-a-template-repository/56577320 %}.
    ~~~ bash
# add dinhanhthi.com as a remote
git remote add template [URL of the template repo]
    ~~~

    ~~~ bash
# update the changes
git fetch --all
    ~~~

    ~~~ bash
# update from template's branch
git merge template/notetheme2
    ~~~
1. If there is an error `fatal: refusing to merge unrelated histories`, try to add `--allow-unrelated-histories`. There must be [conflict](#conflict).
    ~~~ bash
# keep remotes
git merge -X theirs template/notetheme2 --allow-unrelated-histories
# keep local
git merge -X ours template/notetheme2 --allow-unrelated-histories
    ~~~

### Errors

- `fatal: Authentication failed for`: It's because you enabled two-factor authentication in your Github account.
  1. Generate a new token: [click here](https://github.com/settings/tokens).
  2. Copy that token and use it as a new password.